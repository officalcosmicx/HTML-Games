<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Integrated System Console</title>
<!-- Load Tailwind CSS for fast styling -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* Custom styles for the terminal aesthetic */
body {
background-color: #0d1117; /* Dark background */
font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
color: #00ff41; /* Bright green text */
min-height: 100vh;
display: flex;
justify-content: center;
align-items: center;
padding: 20px;
}
#app {
min-height: 90vh; /* Ensure the main container is tall */
}
.terminal-output {
height: 70vh; /* Large fixed height for the output area */
overflow-y: auto;
white-space: pre-wrap;
scrollbar-width: none; /* Hide scrollbar for aesthetics */
-ms-overflow-style: none;
padding-right: 1rem;
}
.terminal-output::-webkit-scrollbar {
display: none;
}
/* Style for the command input area */
#commandInput {
background-color: transparent;
border: none;
color: #00ff41;
outline: none;
flex-grow: 1;
padding-left: 0.5rem;
}
/* Hide number input spinners */
#commandInput::-webkit-inner-spin-button,
#commandInput::-webkit-outer-spin-button {
-webkit-appearance: none;
margin: 0;
}
#commandInput {
-moz-appearance: textfield;
}
</style>
</head>
<body>

<div id="app" class="w-11/12 xl:w-4/5 p-8 rounded-xl shadow-2xl bg-gray-900 border border-green-500/20 flex flex-col">

<!-- Title Bar -->
<div class="flex justify-between items-center mb-4 pb-2 border-b border-green-500/50 text-cyan-400">
<span class="text-sm font-bold">CHROMEOS SHELL INTERFACE (CROSH)</span>
<span class="text-xs">User: root@localhost</span>
</div>

<!-- Terminal Output (Main Area) -->
<div id="terminalOutput" class="terminal-output text-sm flex-grow">
<!-- Content generated by JavaScript -->
</div>

<!-- Command Input Area -->
<div class="mt-4 pt-4 border-t border-green-500/50 flex items-center">
<span id="currentStatus" class="text-yellow-400 mr-4 whitespace-nowrap">CROSH > Select Command:</span>
<input type="number" id="commandInput" class="text-sm" placeholder="Enter command number (1-10)..." min="1" max="10">
<button id="executeButton" class="bg-green-600 hover:bg-green-700 text-gray-900 font-extrabold py-2 px-6 rounded-lg transition duration-200 shadow-lg shadow-green-500/50 disabled:bg-gray-700 disabled:text-gray-500 disabled:shadow-none ml-4">
Execute
</button>
</div>

</div>

<script>
// --- Setup and Constants ---
const outputElement = document.getElementById('terminalOutput');
const commandInput = document.getElementById('commandInput');
const executeButton = document.getElementById('executeButton');
const currentStatusElement = document.getElementById('currentStatus');
const PROCESS_DELAY = 100; // Time delay between lines/steps (ms)
let isProcessing = false;

// Utility functions
const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));
const createProgressBar = (percent) => {
const full = '#';
const empty = '.';
const barLength = 40;
const fillCount = Math.floor(barLength * (percent / 100));
const emptyCount = barLength - fillCount;
const bar = '[' + full.repeat(fillCount) + empty.repeat(emptyCount) + ']';
return `STATUS: ${bar} ${percent}%`;
};

const footerArt = (result) => `

>--=[ PROCESS COMPLETE ]=--<
>--=[ RESULT: ${result} ]=--<
>--=[ TIME: ${new Date().toLocaleTimeString()} ]=--<
`;

/**
* Appends a line to the terminal output and scrolls to the bottom.
*/
function appendLine(text, colorClass = "text-green-400", isRaw = false) {
const p = document.createElement('p');
p.className = colorClass;
if (isRaw) {
p.innerHTML = text;
} else {
p.textContent = text;
}
outputElement.appendChild(p);
outputElement.scrollTop = outputElement.scrollHeight;
}

// --- Process Definitions (Updated to 10) ---

const processSteps = {
'Start OS Shell Command': [ // 1
{ text: "Executing: crosh> run_shell_command.sh", color: "text-cyan-400" },
{ text: "Loading environment variables from /etc/profile...", delay: 300 },
{ text: "Verifying shell dependencies...", delay: 200 },
{ text: "Status: SHELL_SESSION_ID=8412. Shell ready.", color: "text-green-500", delay: 500 },
{ text: "-------------------------------------" },
{ text: "OS Shell Command EXECUTION SUCCESSFUL.", color: "text-yellow-400", delay: 500 },
],

'Swipe OS Data': [ // 2
{ text: "\n[ PHASE 1/3: Data Acquisition ]", color: "text-pink-400" },
{ text: "> Running hash verification on 1.4GB chunk...", color: "text-green-600" },
{ text: "PROGRESS: [#####################...]", progressBar: 30, delay: 50 },
{ text: "PROGRESS: [#####################################...]", progressBar: 65, delay: 50 },
{ text: "PROGRESS: [##########################################]", progressBar: 100, delay: 200 },
{ text: "VERIFICATION: SUCCESS (Checksum: 84b3d9f0)", color: "text-green-500", delay: 300 },
{ text: "\n[ PHASE 2/3: Compression and Encryption ]", color: "text-pink-400" },
{ text: "> Applying Zstandard compression ratio 19...", color: "text-cyan-400" },
{ text: "PROGRESS: [######................................]", progressBar: 15, delay: 70 },
{ text: "PROGRESS: [####################....................]", progressBar: 50, delay: 70 },
{ text: "PROGRESS: [##########################################]", progressBar: 100, delay: 200 },
{ text: "SIZE REDUCTION: 84% (Original: 1.4GB, Final: 224MB)", color: "text-yellow-400", delay: 300 },
{ text: "\n[ PHASE 3/3: Secure Transfer ]", color: "text-pink-400" },
{ text: "> Initiating segmented transfer protocol...", color: "text-green-600" },
{ text: "Segment 1/10: Sent. Status: OK", delay: 150 },
{ text: "Segment 3/10: Sent. Status: FAIL (Retrying...)", color: "text-red-500", delay: 500 },
{ text: "Segment 3/10: Sent. Status: OK", color: "text-green-500", delay: 150 },
{ text: "TRANSFER COMPLETE. Final Payload Size: 224MB", color: "text-green-500", delay: 500 },
],

'Refresh ISO Files': [ // 3
{ text: "Executing: /usr/sbin/iso-integrity-check --force-refresh", color: "text-cyan-400" },
{ text: "Scanning repository index: /mnt/iso/repo.list", delay: 300 },
{ text: "Checking file integrity against remote checksums...", delay: 200 },
{ text: "ISO-CORE-2.1: Checksum OK.", color: "text-green-500", delay: 100 },
{ text: "ISO-DEV-9.3: Checksum MISMATCH. Refreshing...", color: "text-yellow-400", delay: 500 },
{ text: "Download progress (ISO-DEV-9.3.img): [####................................]", progressBar: 10, delay: 70 },
{ text: "Download progress (ISO-DEV-9.3.img): [#####################################...]", progressBar: 95, delay: 70 },
{ text: "Status: ISO files updated and verified.", color: "text-green-500", delay: 500 },
],

'Load New ISO Files': [ // 4
{ text: "Executing: mount_iso_image.sh new_iso_v3.0.img", color: "text-cyan-400" },
{ text: "Connecting to remote source: iso.source.net:443...", delay: 400 },
{ text: "Download progress (new_iso_v3.0.img): [####################....................]", progressBar: 50, delay: 100 },
{ text: "Download progress (new_iso_v3.0.img): [##########################################]", progressBar: 100, delay: 200 },
{ text: "Mounting image to /dev/sdb1...", delay: 400 },
{ text: "Status: Filesystem mounted read-only at /mnt/new_iso.", color: "text-green-500", delay: 500 },
],

'Add Development Features': [ // 5
{ text: "Executing: dpkg --install-packages dev-features-config.list", color: "text-cyan-400" },
{ text: "Installing package: chromium-dev-tools...", delay: 150 },
{ text: "Installing package: debug-utility-kit...", delay: 150 },
{ text: "Installing package: system-monitor-daemon...", delay: 150 },
{ text: "Dependencies resolved. 14 packages installed.", color: "text-yellow-400", delay: 400 },
{ text: "Configuration files written to /etc/dev-features/", delay: 200 },
{ text: "Status: Development features enabled. Restart shell for full effect.", color: "text-green-500", delay: 500 },
],

'Run Final Commands': [ // 6
{ text: "Executing batch file: /tmp/batch_commands.cfg", color: "text-cyan-400" },
{ text: "CMD 1/4: Set network policy to 'transparent'...", delay: 150 },
{ text: "Status: OK", color: "text-green-500" },
{ text: "CMD 2/4: Modify security descriptor on target file...", delay: 150 },
{ text: "Status: OK", color: "text-green-500" },
{ text: "CMD 3/4: Restart service 'security_daemon'...", delay: 300 },
{ text: "Status: Service restarted successfully.", color: "text-green-500", delay: 200 },
{ text: "CMD 4/4: Check system stability...", delay: 200 },
{ text: "Status: STABLE. All commands completed.", color: "text-yellow-400", delay: 500 },
],

'System CleanUp': [ // 7
{ text: "Executing: clean-system --aggressive --logs", color: "text-cyan-400" },
{ text: "Removing user-level caches... 89MB cleaned.", delay: 200 },
{ text: "Clearing browser and session history... OK", delay: 200 },
{ text: "Truncating journalctl logs...", delay: 200 },
{ text: "Removing temporary files from /tmp/... 2,104 files deleted.", color: "text-yellow-400", delay: 300 },
{ text: "Status: System resources optimized.", color: "text-green-500", delay: 500 },
],

'Wipe Data History': [ // 8
{ text: "Executing: secure-overwrite --device /dev/storage", color: "text-cyan-400" },
{ text: "Wipe routine: Department of Defense (DoD) Standard 5220.22-M", color: "text-yellow-400", delay: 500 },
{ text: "Pass 1/3: Writing zero bytes...", color: "text-green-600", delay: 300 },
{ text: "PROGRESS: [##############..........................]", progressBar: 35, delay: 150 },
{ text: "Pass 2/3: Writing random data...", color: "text-green-600", delay: 300 },
{ text: "PROGRESS: [##########################..............]", progressBar: 65, delay: 150 },
{ text: "Pass 3/3: Final verification pass...", color: "text-green-600", delay: 300 },
{ text: "PROGRESS: [##########################################]", progressBar: 100, delay: 150 },
{ text: "Status: Data history successfully overwritten and verified.", color: "text-green-500", delay: 500 },
],

'Check System Status': [ // 9 (New)
{ text: "Executing: sysctl --status --verbose", color: "text-cyan-400" },
{ text: "Checking critical processes... (PID 100-500)", delay: 300 },
{ text: "CPU Load: 45% | Memory Usage: 72% (Critical Threshold: 80%)", delay: 200, color: "text-red-500" },
{ text: "Network Latency: 4ms | Interface: eth0", delay: 200 },
{ text: "Security Daemon Status: Active", color: "text-green-500", delay: 300 },
],

'Log User Activity': [ // 10 (New)
{ text: "Executing: log_activity --user root --level secure", color: "text-cyan-400" },
{ text: "Analyzing session duration and keystroke patterns...", delay: 500 },
{ text: "Generating cryptographically secure session report...", delay: 500 },
{ text: "Report saved to /var/log/secure/session_881.log", color: "text-yellow-400", delay: 300 },
{ text: "LOGGING COMPLETE. Data ready for export.", color: "text-green-500", delay: 200 },
],
};

const processNames = Object.keys(processSteps);

// --- Main Logic ---

/**
* Clears the terminal and prints the numbered command menu.
*/
function showCommandMenu() {
outputElement.innerHTML = '';
appendLine("Welcome to the CROSH root terminal.", "text-yellow-400");
appendLine("-------------------------------------");
appendLine("Available EXECUTION STAGES (Enter corresponding number 1-10):", "text-cyan-400");
appendLine("-------------------------------------");

processNames.forEach((name, index) => {
appendLine(`[${index + 1}] ${name}`);
});

appendLine("-------------------------------------");
appendLine("CROSH> Ready for command selection...", "text-green-500");
currentStatusElement.textContent = "CROSH > Select Command:";
commandInput.focus();
}

/**
* Disables/enables input elements and updates status.
*/
function setProcessingState(running, processName = null) {
isProcessing = running;
executeButton.disabled = running;
commandInput.disabled = running;

if (running) {
currentStatusElement.textContent = `CROSH > Executing "${processName}"...`;
} else {
currentStatusElement.textContent = `CROSH > Select Command:`;
}
}

/**
* The main process execution logic.
*/
async function runProcess(commandNumber) {
const index = commandNumber - 1;

if (index < 0 || index >= processNames.length) {
appendLine(`\nERROR: Invalid command number (${commandNumber}). Please enter a number between 1 and 10.`, "text-red-500");
appendLine("\nCROSH> _", "text-green-400");
return;
}

const processName = processNames[index];
setProcessingState(true, processName);
outputElement.innerHTML = ''; // Clear previous output

appendLine(`CROSH> EXECUTE ${commandNumber} (${processName.toUpperCase()})`, "text-yellow-400");
appendLine("-------------------------------------");

const steps = processSteps[processName];

for (const step of steps) {
let lineText = step.text;

// Handle progress bar generation
if (step.progressBar !== undefined) {
lineText = createProgressBar(step.progressBar);
}

appendLine(lineText, step.color, step.isRaw);
await sleep(step.delay || PROCESS_DELAY);
}

// Final message and cleanup
appendLine(footerArt("OPERATION SUCCESSFUL"), "text-green-400", true);
appendLine("\nCROSH> Type 'menu' or press Enter to return to command selection.", "text-cyan-400");

setProcessingState(false);
commandInput.value = '';
commandInput.focus();
}

// --- Event Handlers ---

function handleExecution() {
if (isProcessing) return;

const input = commandInput.value.trim();
commandInput.value = ''; // Clear input immediately

if (!input) {
// Treat blank enter/execute as a request for the menu
showCommandMenu();
return;
}

// Check for 'menu' command explicitly
if (input.toLowerCase() === 'menu') {
showCommandMenu();
return;
}

const commandNumber = parseInt(input, 10);
runProcess(commandNumber);
}

executeButton.addEventListener('click', handleExecution);
commandInput.addEventListener('keydown', (e) => {
if (e.key === 'Enter') {
handleExecution();
}
});


// Initialize the application when the window loads
window.onload = showCommandMenu;

</script>

</body>
</html>
